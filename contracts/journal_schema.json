{
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "event_id",
    "sequence",
    "ts_utc",
    "tzid",
    "offset_minutes",
    "event_type",
    "payload",
    "run_id"
  ],
  "properties": {
    "schema_version": {"type": "integer"},
    "event_id": {"type": "string"},
    "sequence": {"type": "integer"},
    "ts_utc": {"type": "string"},
    "tzid": {"type": "string"},
    "offset_minutes": {"type": "integer"},
    "event_type": {"type": "string"},
    "payload": {"type": "object"},
    "run_id": {"type": "string"}
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "event_type": {
            "enum": ["capture.stage", "capture.commit", "capture.unavailable"]
          }
        }
      },
      "then": {
        "properties": {
          "payload": {
            "type": "object",
            "required": ["record_id", "record_type"]
          }
        }
      }
    }
  ]
}
