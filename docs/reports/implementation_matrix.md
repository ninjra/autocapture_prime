# Implementation matrix (initial inventory)

Source: `docs/blueprints/autocapture_nx_blueprint.md`

| ItemID | Phase | Title | Status | Evidence | Planned change summary | Test / gate |
| --- | --- | --- | --- | --- | --- | --- |
| I084 | Phase 0: Scaffolding and gates | Split heavy ML dependencies into optional extras | missing | pyproject.toml | Implement per blueprint; enforce in: pyproject.toml extras; plugin import boundaries (no unconditional torch/transformers imports); builtin plugin manifests declare optional deps | CI matrix: minimal install runs capture+stores without ML deps; CI matrix: extras[vision]/[embeddings]/[sqlcipher] enable corresponding plugins; Gate: import-time scan ensures no heavy deps imported in ACTIVE ingest path |
| I085 | Phase 0: Scaffolding and gates | Make resource paths package-safe (no CWD dependence) | missing | autocapture_nx/kernel/config.py; autocapture_nx/kernel/loader.py; config/default.json | Implement per blueprint; enforce in: Replace relative paths with `importlib.resources` for packaged assets; `autocapture_nx/kernel/paths.py` (new) centralizes path resolution | Test: run from arbitrary CWD and verify default.json/contracts/plugins load; Wheel install test: builtin plugins discoverable and loadable |
| I086 | Phase 0: Scaffolding and gates | Use OS-appropriate default data/config dirs (platformdirs) | missing | autocapture_nx/kernel/config.py; autocapture_nx/kernel/loader.py; config/default.json | Implement per blueprint; enforce in: Use `platformdirs` to pick Windows-first locations; Config schema: `paths.config_dir`, `paths.data_dir` resolved at boot | Test matrix: Windows/Linux/WSL path resolution produces valid dirs; Doctor check: directories exist and are writable; vault is restricted |
| I087 | Phase 0: Scaffolding and gates | Package builtin plugins as package data | missing | pyproject.toml; plugins/builtin/ | Implement per blueprint; enforce in: Packaging: include `plugins/builtin/**` as package data; Plugin discovery uses package resources when installed | Wheel install test: `autocapture doctor` lists builtin plugins; Gate: plugin lock hashing includes packaged plugin files |
| I088 | Phase 0: Scaffolding and gates | Add reproducible dependency lockfile (hash-locked) | missing | pyproject.toml | Implement per blueprint; enforce in: Dependency lock: `requirements.lock` or `uv.lock` with hashes; CI verifies lock integrity and matches pyproject constraints | Gate: lock drift check fails if deps change without lock update; Supply-chain test: install from lock only; run smoke tests |
| I089 | Phase 0: Scaffolding and gates | Add canonical-json safety tests for journal/ledger payloads | partial | autocapture_nx/kernel/canonical_json.py; autocapture/core/hashing.py; tests/test_canonical_json.py | Implement per blueprint; enforce in: Unit tests for canonical-json compliance across all event builders; Gate: `tools/gate_canon.py` runs in CI | Test: generate sample events from each plugin; validate canonical JSON; Gate: fail on floats/bytes/non-UTC timestamps |
| I090 | Phase 0: Scaffolding and gates | Add concurrency tests for ledger/journal append correctness | missing | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: Thread-safety tests for ledger/journal writers; Gate: `tools/gate_concurrency.py` | Test: multi-thread append; verify entry count and stable chain; Test: forced thread interleavings do not corrupt files |
| I091 | Phase 0: Scaffolding and gates | Add golden chain test: ledger verify + anchor verify | partial | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: Golden test corpus for ledger chain + anchors; Gate: `tools/gate_ledger.py` verifies replay | Test: produce N entries; verify chain and anchor head deterministically; Test: tamper with one entry; verification fails |
| I092 | Phase 0: Scaffolding and gates | Add performance regression tests (capture latency/memory/query latency) | missing | tools/run_all_tests.py | Implement per blueprint; enforce in: Perf suite: capture tick latency, memory ceiling, query latency; Gate: `tools/gate_perf.py` with thresholds | Bench: sustained capture at configured fps; assert bounded RAM; Bench: query over N records completes under budget |
| I093 | Phase 0: Scaffolding and gates | Add security regression tests (DPAPI fail-closed, network guard, no raw egress) | partial | tests/test_network_guard.py; tests/test_plugin_network_block.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: Security test suite run in CI; Gate: `tools/gate_security.py` | Test: DPAPI failure with encryption_required causes hard failure; Test: kernel process cannot open network sockets; Test: unsanitized egress blocked unless dangerous_ops enabled |
| I094 | Phase 0: Scaffolding and gates | Static analysis: ruff + typing + vuln scan | missing | pyproject.toml | Implement per blueprint; enforce in: Static analysis in CI (lint, type checks, dependency scan) | CI fails on new lint/type errors; CI fails on high-severity dependency vulnerabilities (policy-defined) |
| I095 | Phase 0: Scaffolding and gates | Doctor validates locks, storage, anchors, and network policy | partial | autocapture_nx/kernel/loader.py; autocapture_nx/cli.py | Implement per blueprint; enforce in: `autocapture doctor` (new) + `tools/gate_doctor.py` | Test: doctor detects missing lockfile, plugin hash mismatch, bad perms; Test: doctor output is stable (snapshot test) |
| I126 | Phase 0: Scaffolding and gates | Make sha256_directory path sorting deterministic across OSes | partial | autocapture_nx/kernel/hashing.py | Implement per blueprint; enforce in: `autocapture_nx/kernel/hashing.py` sha256_directory ordering; Used by plugin hashing + contract lock hashing | Test: same directory hashed on Windows/Linux yields identical digest; Gate: plugin lock update is deterministic on same content |
| I001 | Phase 1: Correctness + immutability blockers | Eliminate floats from journal/ledger payloads | complete | autocapture_nx/kernel/canonical_json.py; autocapture_nx/kernel/event_builder.py; plugins/builtin/journal_basic/plugin.py; plugins/builtin/ledger_basic/plugin.py; tests/test_canonical_payloads.py | Implemented canonical JSON enforcement for journal/ledger payloads (no floats/bytes). | tests/test_canonical_payloads.py; tests/test_canonical_json.py; tools/gate_canon.py |
| I002 | Phase 1: Correctness + immutability blockers | Make backpressure actually affect capture rate | complete | plugins/builtin/backpressure_basic/plugin.py; plugins/builtin/capture_windows/plugin.py; autocapture_nx/windows/win_capture.py; tests/test_backpressure.py; tests/test_capture_rate.py | Capture loop uses dynamic fps provider; backpressure adjusts fps/bitrate and logs rate changes. | tests/test_backpressure.py; tests/test_capture_rate.py |
| I003 | Phase 1: Correctness + immutability blockers | Stop buffering whole segments in RAM; stream segments | complete | plugins/builtin/capture_windows/plugin.py; plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_memory/plugin.py; tests/test_capture_streaming.py | Segment writer streams zip to media store via put_stream; no full-segment buffering. | tests/test_capture_streaming.py |
| I004 | Phase 1: Correctness + immutability blockers | Do not write to storage from realtime audio callback | complete | plugins/builtin/audio_windows/plugin.py; tests/test_audio_callback_queue.py | Audio callback enqueues buffers; writer thread handles storage IO. | tests/test_audio_callback_queue.py |
| I005 | Phase 1: Correctness + immutability blockers | Stop mutating primary evidence metadata during query | complete | autocapture_nx/kernel/query.py; autocapture_nx/kernel/metadata_store.py; tests/test_query_derived_records.py | Query writes derived records and preserves immutable evidence metadata. | tests/test_query_derived_records.py |
| I006 | Phase 1: Correctness + immutability blockers | Introduce globally unique run/session identifier; prefix all record IDs | complete | autocapture_nx/kernel/ids.py; autocapture_nx/kernel/event_builder.py; plugins/builtin/capture_windows/plugin.py; plugins/builtin/audio_windows/plugin.py; plugins/builtin/input_windows/plugin.py; plugins/builtin/window_metadata_windows/plugin.py; tests/test_journal_run_id.py; tests/test_run_state_entries.py | Run_id generated at boot and prefixed in record IDs; journal entries stamped. | tests/test_journal_run_id.py; tests/test_run_state_entries.py |
| I007 | Phase 1: Correctness + immutability blockers | Make ledger writing thread-safe | complete | plugins/builtin/ledger_basic/plugin.py; tests/test_ledger_journal_concurrency.py | Ledger append guarded by lock; hash chain verified under concurrency. | tests/test_ledger_journal_concurrency.py |
| I008 | Phase 1: Correctness + immutability blockers | Make journal writing thread-safe; centralize sequences | complete | plugins/builtin/journal_basic/plugin.py; tests/test_ledger_journal_concurrency.py | Journal append guarded by lock with centralized sequencing. | tests/test_ledger_journal_concurrency.py |
| I009 | Phase 1: Correctness + immutability blockers | Fail closed if DPAPI protection fails when encryption_required | complete | autocapture_nx/kernel/keyring.py; plugins/builtin/storage_encrypted/plugin.py; tests/test_encrypted_store_fail_loud.py | DPAPI protection required when encryption_required; decrypt failures raise. | tests/test_encrypted_store_fail_loud.py |
| I010 | Phase 1: Correctness + immutability blockers | Sort all store keys deterministically | complete | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_memory/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; tests/test_storage_encrypted.py | Store key listings are sorted deterministically. | tests/test_storage_encrypted.py |
| I011 | Phase 1: Correctness + immutability blockers | Use monotonic clocks for segment duration | complete | plugins/builtin/capture_windows/plugin.py; tests/test_capture_monotonic.py | Segment duration uses monotonic clock. | tests/test_capture_monotonic.py |
| I012 | Phase 1: Correctness + immutability blockers | Align default config with implemented capture backend | complete | config/default.json; plugins/builtin/capture_windows/plugin.py; tests/test_capture_backend_default.py | Default capture backend set to mss; unsupported backend rejected. | tests/test_capture_backend_default.py |
| I013 | Phase 1: Correctness + immutability blockers | Remove hard-coded model paths; config-driven + portable | complete | config/default.json; plugins/builtin/embedder_stub/plugin.py; plugins/builtin/reranker_stub/plugin.py; plugins/builtin/vlm_stub/plugin.py; tests/test_model_paths_config.py | Model paths are config-driven and default to None/relative (no hard-coded host paths). | tests/test_model_paths_config.py |
| I014 | Phase 1: Correctness + immutability blockers | Enforce plugin compat.requires_kernel / schema versions | complete | autocapture_nx/plugin_system/registry.py; tests/test_plugin_loader.py | Registry enforces compat.requires_kernel and requires_schema_versions. | tests/test_plugin_loader.py |
| I015 | Phase 1: Correctness + immutability blockers | Verify contract lock at boot/doctor | complete | autocapture_nx/kernel/loader.py; tests/test_contract_pins.py | Boot verifies contract lock integrity. | tests/test_contract_pins.py |
| I096 | Phase 1: Correctness + immutability blockers | Fail loud on decrypt errors when encryption_required | complete | autocapture_nx/kernel/keyring.py; plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; tests/test_encrypted_store_fail_loud.py | Decrypt errors fail loud when encryption_required. | tests/test_encrypted_store_fail_loud.py |
| I097 | Phase 1: Correctness + immutability blockers | Add record type fields everywhere | complete | autocapture_nx/kernel/metadata_store.py; plugins/builtin/capture_windows/plugin.py; plugins/builtin/window_metadata_windows/plugin.py; tests/test_metadata_record_type.py | record_type required in metadata; capture/window records include it. | tests/test_metadata_record_type.py |
| I098 | Phase 1: Correctness + immutability blockers | Add unified EventBuilder helper | complete | autocapture_nx/kernel/event_builder.py; autocapture_nx/kernel/loader.py; plugins/builtin/capture_windows/plugin.py; plugins/builtin/audio_windows/plugin.py; tests/test_event_builder.py | EventBuilder centralizes journal/ledger emission for plugins. | tests/test_event_builder.py |
| I099 | Phase 1: Correctness + immutability blockers | Stamp every journal event with run_id | complete | plugins/builtin/journal_basic/plugin.py; autocapture_nx/kernel/event_builder.py; tests/test_journal_run_id.py | Journal events stamped with run_id and prefixed event_id. | tests/test_journal_run_id.py |
| I100 | Phase 1: Correctness + immutability blockers | Cache policy snapshot hashing per run | complete | autocapture_nx/kernel/event_builder.py; tests/test_event_builder.py | Policy snapshot hash cached per run. | tests/test_event_builder.py |
| I123 | Phase 1: Correctness + immutability blockers | Write kernel boot ledger entry system.start | complete | autocapture_nx/kernel/loader.py; tests/test_run_state_entries.py | Boot writes system.start ledger entry. | tests/test_run_state_entries.py |
| I124 | Phase 1: Correctness + immutability blockers | Write kernel shutdown ledger entry system.stop | complete | autocapture_nx/kernel/loader.py; tests/test_run_state_entries.py | Shutdown writes system.stop ledger entry. | tests/test_run_state_entries.py |
| I125 | Phase 1: Correctness + immutability blockers | Write crash ledger entry on next startup | complete | autocapture_nx/kernel/loader.py; tests/test_run_state_entries.py | Next boot writes system.crash_detected if prior run not clean. | tests/test_run_state_entries.py |
| I016 | Phase 2: Capture pipeline refactor | Split capture into grab → encode/pack → encrypt/write pipeline | complete | autocapture_nx/capture/pipeline.py; plugins/builtin/capture_windows/plugin.py | Capture pipeline runs grab/encode/write stages with bounded queues. | tests/test_capture_streaming.py |
| I017 | Phase 2: Capture pipeline refactor | Bounded queues with explicit drop policies | complete | autocapture_nx/capture/queues.py; autocapture_nx/capture/pipeline.py | Bounded queues with drop_oldest policy and drop events recorded. | tests/test_capture_drop_event.py |
| I018 | Phase 2: Capture pipeline refactor | Replace zip-of-JPEG with real video container for primary artifact | complete | autocapture_nx/capture/pipeline.py | Primary segments use avi_mjpeg/ffmpeg_mp4; zip kept as legacy. | tests/test_capture_streaming.py; tests/test_capture_zip_container.py |
| I019 | Phase 2: Capture pipeline refactor | Add GPU-accelerated capture/encode backend (NVENC/DD) | complete | autocapture_nx/capture/pipeline.py; autocapture_nx/windows/win_capture.py | DXCAM backend with NVENC encode via ffmpeg_mp4 when configured. | tests/test_capture_container_resolution.py |
| I020 | Phase 2: Capture pipeline refactor | Record segment start/end timestamps | complete | autocapture_nx/capture/pipeline.py | Segment metadata includes ts_start_utc/ts_end_utc and duration. | tests/test_capture_monotonic.py |
| I021 | Phase 2: Capture pipeline refactor | Record capture parameters per segment | complete | autocapture_nx/capture/pipeline.py | Segment metadata includes capture parameters and achieved metrics. | tests/test_capture_streaming.py |
| I022 | Phase 2: Capture pipeline refactor | Correlate frames with active window via synchronized timeline | complete | plugins/builtin/window_metadata_windows/plugin.py; autocapture_nx/capture/pipeline.py | Window timeline records rect+monitor; segments include window_ref. | tests/test_capture_window_input_refs.py; tests/test_monitor_selection.py |
| I023 | Phase 2: Capture pipeline refactor | Add cursor/input correlation timeline references | complete | plugins/builtin/input_windows/plugin.py; autocapture_nx/capture/pipeline.py | Input batch events and segment input_ref snapshots. | tests/test_input_batching.py; tests/test_capture_window_input_refs.py |
| I024 | Phase 2: Capture pipeline refactor | Disk pressure degrades capture quality before stopping | complete | autocapture_nx/capture/pipeline.py | Disk pressure reduces fps/bitrate before stopping; emits events. | tests/test_capture_disk_pressure_degrade.py |
| I025 | Phase 2: Capture pipeline refactor | Atomic segment writes (temp + os.replace) | complete | autocapture_nx/capture/pipeline.py | Segment writer uses temp files and os.replace before store write. | tests/test_capture_streaming.py |
| I105 | Phase 2: Capture pipeline refactor | If keeping zips, use ZIP_STORED for JPEG frames | complete | autocapture_nx/capture/pipeline.py | ZIP_STORED used for legacy zip segments. | tests/test_capture_zip_container.py |
| I106 | Phase 2: Capture pipeline refactor | If keeping zips, stream ZipFile writes to a real file | complete | autocapture_nx/capture/pipeline.py | ZipFile writes to on-disk temp file, then replace. | tests/test_capture_zip_container.py |
| I107 | Phase 2: Capture pipeline refactor | Batch input events to reduce write overhead | complete | plugins/builtin/input_windows/plugin.py; plugins/builtin/journal_basic/plugin.py | Input events batched into input.batch; journal supports append_batch. | tests/test_input_batching.py; tests/test_journal_batch.py |
| I109 | Phase 2: Capture pipeline refactor | Add WASAPI loopback option for system audio capture | complete | plugins/builtin/audio_windows/plugin.py | Audio mode supports loopback via WASAPI when configured. | tests/test_audio_encoding.py |
| I110 | Phase 2: Capture pipeline refactor | Store audio as PCM/FLAC/Opus derived artifact | complete | plugins/builtin/audio_windows/plugin.py | Audio stored as derived artifacts with PCM/WAV; optional flac/opus via ffmpeg. | tests/test_audio_encoding.py |
| I111 | Phase 2: Capture pipeline refactor | Normalize active window process paths (device → drive paths) | complete | autocapture_nx/windows/win_window.py; plugins/builtin/window_metadata_windows/plugin.py | Window process paths normalized to drive paths. | tests/test_window_path_normalization.py |
| I112 | Phase 2: Capture pipeline refactor | Capture window.rect and monitor mapping | complete | autocapture_nx/windows/win_window.py; plugins/builtin/window_metadata_windows/plugin.py | Window metadata includes rect and monitor info. | tests/test_monitor_selection.py |
| I113 | Phase 2: Capture pipeline refactor | Optional cursor position+shape capture | complete | autocapture_nx/windows/win_cursor.py; autocapture_nx/capture/pipeline.py | Optional cursor metadata included on segments when enabled. | tests/test_capture_cursor_metadata.py |
| I026 | Phase 3: Storage scaling + durability | Default to SQLCipher for metadata when available | partial | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: storage backend selection: prefer SQLCipher for metadata; config: `storage.metadata_backend=sqlcipher|encrypted_fs` | Test: metadata queries faster than directory scan at N records; Security: DB file encrypted and unreadable without key |
| I027 | Phase 3: Storage scaling + durability | Add DB indexes on ts_utc, record_type, run_id | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: SQLCipher schema: indexes on `ts_utc`, `record_type`, `run_id` | EXPLAIN-based test: queries use indexes for common patterns |
| I028 | Phase 3: Storage scaling + durability | Store media in binary encrypted format (not base64 JSON) | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: media store format: binary encrypted files with versioned header | Test: media blobs are not valid JSON and have expected magic/version; Test: decrypt+verify hash roundtrip works |
| I029 | Phase 3: Storage scaling + durability | Stream encryption (avoid whole-segment in memory) | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: media encryption writer supports streaming/chunking | Perf: writing large segments does not allocate segment-sized RAM; Test: chunk boundaries validate and reject tampering |
| I030 | Phase 3: Storage scaling + durability | Immutability/versioning in stores (put_new vs put_replace) | partial | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: store APIs: `put_new()` for immutable; `put_replace()` only for caches; kernel enforces type-based mutability rules | Gate-IMMUT: evidence types cannot call replace; tests enforce |
| I031 | Phase 3: Storage scaling + durability | Make record ID encoding reversible (no lossy mapping) | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: record ID encoding/locator encoding is reversible | Test: encode→decode roundtrip yields same ID for all legal IDs |
| I032 | Phase 3: Storage scaling + durability | Shard media/metadata directories by date/run | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: storage layout: shard by run/date to limit directory sizes | Perf test: listing/iterating keys remains fast at large scale |
| I033 | Phase 3: Storage scaling + durability | Add per-run storage manifest records | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: per-run manifest records (Pattern A) stored and ledgered | Test: manifest exists for each run and includes expected hashes |
| I034 | Phase 3: Storage scaling + durability | Configurable fsync policy (critical vs bulk) | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: fsync policy config applied in writers | Crash test: critical records survive; bulk media may lag but seals prevent inconsistency |
| I101 | Phase 3: Storage scaling + durability | Add content_hash to metadata for every media put | partial | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: media store returns content_hash; metadata stores it for every blob | Test: content_hash present and matches recomputed hash after decrypt |
| I102 | Phase 3: Storage scaling + durability | Track partial failures explicitly in journal/ledger | missing | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: all failures emit typed journal/ledger events | Test: injected failures produce explicit failure records |
| I103 | Phase 3: Storage scaling + durability | Add segment sealing ledger entry after successful write | missing | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: segment lifecycle includes explicit `segment.sealed` ledger entry | Test: sealed only after media+metadata committed and hashes known |
| I104 | Phase 3: Storage scaling + durability | Add startup recovery scanner to reconcile stores | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: startup recovery scanner reconciles temp/partial artifacts; writes recovery actions to ledger/journal | Crash simulation: partial writes detected and repaired/quarantined |
| I108 | Phase 3: Storage scaling + durability | Add compact binary input log (derived) + JSON summary | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: input pipeline writes compact binary derived log + JSON summary records | Test: binary log roundtrip decode; JSON summary matches counts/time range |
| I128 | Phase 3: Storage scaling + durability | Tooling to migrate data_dir safely (copy+verify, no delete) | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: CLI/API command: `storage.migrate` copy+verify strategy | Test: migrate copies all evidence and manifests; verification passes |
| I129 | Phase 3: Storage scaling + durability | Disk usage forecasting (days remaining) + alerts | partial | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: telemetry + alerts: disk usage trends and days remaining estimate | Test: forecasting produces deterministic output for fixed input series |
| I130 | Phase 3: Storage scaling + durability | Storage compaction for derived artifacts only | missing | plugins/builtin/storage_encrypted/plugin.py; plugins/builtin/storage_sqlcipher/plugin.py; autocapture/storage/database.py | Implement per blueprint; enforce in: compaction applies only to derived artifacts and rebuildable indexes | Gate-IMMUT: compaction never touches primary evidence; Test: compaction reduces size; citations still resolve |
| I035 | Phase 4: Retrieval + provenance + citations | Replace full-scan query with tiered indexed retrieval | partial | plugins/builtin/retrieval_basic/plugin.py; autocapture/retrieval/tiers.py | Implement per blueprint; enforce in: retrieval pipeline plugin replaces full-scan approach; SQLCipher/FTS + optional embeddings | Perf: query latency improves at N records vs full scan baseline; Accuracy: golden queries return expected evidence set deterministically |
| I036 | Phase 4: Retrieval + provenance + citations | Deterministic retrieval ordering (stable sort keys) | partial | plugins/builtin/retrieval_basic/plugin.py; autocapture/retrieval/tiers.py | Implement per blueprint; enforce in: retrieval sorts by stable keys: time, record_type, evidence_id | Test: same dataset yields identical ranked output across runs |
| I037 | Phase 4: Retrieval + provenance + citations | Candidate-first extraction (retrieve then extract) | missing | autocapture_nx/kernel/query.py | Implement per blueprint; enforce in: extraction planner: select candidates then extract | Perf: extraction work bounded to top-K candidates; Accuracy: extraction uses explicit time/span constraints |
| I038 | Phase 4: Retrieval + provenance + citations | Derived artifact records for OCR/VLM outputs | missing | autocapture_nx/kernel/query.py | Implement per blueprint; enforce in: schema: `derived.text.*` records; store APIs enforce immutability (I30) | Test: derived text record includes parent reference and span_ref; Test: model identity fields present and hashed |
| I039 | Phase 4: Retrieval + provenance + citations | Ledger query executions (inputs/outputs) | missing | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: query execution writes ledger entry: inputs + retrieval plan + outputs | Golden: query ledger entry reproducible for fixed corpus |
| I040 | Phase 4: Retrieval + provenance + citations | Ledger extraction operations (inputs/outputs) | missing | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: extraction writes ledger entry linking inputs/outputs | Test: derived artifacts have corresponding ledger derivation entries |
| I041 | Phase 4: Retrieval + provenance + citations | Citations point to immutable evidence IDs + spans | partial | plugins/builtin/citation_basic/plugin.py; autocapture/memory/citations.py; autocapture/web/routes/citations.py | Implement per blueprint; enforce in: citation schema uses evidence_id + span_ref + hashes | Schema test: citations cannot be created without required fields |
| I042 | Phase 4: Retrieval + provenance + citations | Citation resolver validates hashes/anchors/spans | missing | plugins/builtin/citation_basic/plugin.py; autocapture/memory/citations.py; autocapture/web/routes/citations.py | Implement per blueprint; enforce in: citation resolver service + CLI validates evidence and provenance | Test: resolver detects tampering and missing spans |
| I043 | Phase 4: Retrieval + provenance + citations | Fail closed if citations do not resolve | missing | plugins/builtin/citation_basic/plugin.py; autocapture/memory/citations.py; autocapture/web/routes/citations.py | Implement per blueprint; enforce in: answer pipeline refuses to return `state=ok` if citations unresolved | Golden tests: unresolved citations produce `state=no_evidence` or `state=partial` |
| I065 | Phase 4: Retrieval + provenance + citations | Define canonical evidence model (EvidenceObject) | missing | autocapture/capture/models.py; autocapture/core/hashing.py | Implement per blueprint; enforce in: contracts: evidence schema and versioning; EventBuilder enforces EvidenceObject fields | Schema tests cover all evidence types and require minimal fields |
| I066 | Phase 4: Retrieval + provenance + citations | Hash everything that matters (media/metadata/derived) | partial | autocapture/capture/models.py; autocapture/core/hashing.py | Implement per blueprint; enforce in: hashing: media plaintext SHA-256; metadata canonical-json hash | Verify: recomputed hashes match stored hashes for sample corpus |
| I067 | Phase 4: Retrieval + provenance + citations | Ledger every state transition | missing | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: ledger coverage expanded across all plugins and transitions | Gate: required event types appear for each run (start, evidence writes, stop/crash) |
| I068 | Phase 4: Retrieval + provenance + citations | Anchor on schedule (N entries or M minutes) | partial | plugins/builtin/anchor_basic/plugin.py; tests/test_anchor.py | Implement per blueprint; enforce in: anchor plugin anchors ledger head on schedule | Test: anchors created at configured cadence; verification passes |
| I069 | Phase 4: Retrieval + provenance + citations | Immutable per-run manifest (config+locks+versions) | missing | autocapture/capture/models.py; autocapture/core/hashing.py | Implement per blueprint; enforce in: run manifest evidence record written early and finalized at end | Test: manifest includes config/plugin/contracts hashes + versions |
| I070 | Phase 4: Retrieval + provenance + citations | Citation objects carry verifiable pointers | missing | plugins/builtin/citation_basic/plugin.py; autocapture/memory/citations.py; autocapture/web/routes/citations.py | Implement per blueprint; enforce in: citation schema: include evidence hash + ledger/anchor refs | Resolver rejects citations missing required verification fields |
| I071 | Phase 4: Retrieval + provenance + citations | Citation resolver CLI/API | missing | plugins/builtin/citation_basic/plugin.py; autocapture/memory/citations.py; autocapture/web/routes/citations.py | Implement per blueprint; enforce in: CLI/API endpoints: `verify citation`, `resolve citation` | Golden: resolver output stable and correct for known citations |
| I072 | Phase 4: Retrieval + provenance + citations | Metadata immutable by default; derived never overwrites | missing | autocapture_nx/kernel/query.py | Implement per blueprint; enforce in: store mutability policies enforced per record_type (I30) | Gate-IMMUT catches any overwrite on evidence/derived records |
| I073 | Phase 4: Retrieval + provenance + citations | Persist derivation graphs (parent→child links) | missing | autocapture/capture/models.py; autocapture/core/hashing.py | Implement per blueprint; enforce in: derivation graph store and schema; ledger entries reference derivation edges | Test: derived artifacts create derivation edge to parent |
| I074 | Phase 4: Retrieval + provenance + citations | Record model identity for ML outputs | missing | autocapture/capture/models.py; autocapture/core/hashing.py | Implement per blueprint; enforce in: model identity schema and recording in derived artifacts; model manager records weight digests (Phase 6) | Test: derived artifacts contain model_name + model_digest + params |
| I075 | Phase 4: Retrieval + provenance + citations | Deterministic text normalization before hashing | partial | autocapture_nx/kernel/canonical_json.py; autocapture/core/hashing.py; tests/test_canonical_json.py | Implement per blueprint; enforce in: text normalization function used before hashing and indexing | Test: normalization is deterministic and stable on sample inputs |
| I076 | Phase 4: Retrieval + provenance + citations | Proof bundles export (evidence + ledger slice + anchors) | missing | autocapture/pillars/citable.py; autocapture_nx/cli.py | Implement per blueprint; enforce in: proof bundle exporter in UX facade | Test: exported bundle verifies on a clean machine without network |
| I077 | Phase 4: Retrieval + provenance + citations | Replay mode validates citations without model calls | missing | plugins/builtin/citation_basic/plugin.py; autocapture/memory/citations.py; autocapture/web/routes/citations.py | Implement per blueprint; enforce in: replay tool validates retrieval/citations without model calls | Golden: replay reproduces expected citations and verification results |
| I118 | Phase 4: Retrieval + provenance + citations | Index versioning for retrieval reproducibility | missing | plugins/builtin/retrieval_basic/plugin.py; autocapture/retrieval/tiers.py | Implement per blueprint; enforce in: indexes record version/digest in manifest and query ledger entries | Test: query includes index version refs; rebuild increments version |
| I127 | Phase 4: Retrieval + provenance + citations | Record python/OS/package versions into run manifest | missing | autocapture/capture/models.py; autocapture/core/hashing.py | Implement per blueprint; enforce in: run manifest captures environment versions | Test: manifest contains python version, OS build, package versions list |
| I044 | Phase 5: Scheduler/governor | Real scheduler plugin gates heavy work on user activity | partial | autocapture/runtime/governor.py; autocapture/runtime/scheduler.py; autocapture/runtime/budgets.py; plugins/builtin/runtime_governor/plugin.py | Implement per blueprint; enforce in: new scheduler plugin (builtin): job admission based on activity; governor API used by all heavy workers | Test: ACTIVE mode prevents OCR/VLM/embeddings/indexing jobs from running; Test: IDLE mode allows bounded enrichment and records budgets in journal |
| I045 | Phase 5: Scheduler/governor | Input tracker exposes activity signals (not only journal) | partial | plugins/builtin/input_windows/plugin.py | Implement per blueprint; enforce in: input_windows exposes aggregated activity signal channel to governor | Test: simulated input produces immediate ACTIVE signal; Test: inactivity decays to IDLE after configured timeout |
| I046 | Phase 5: Scheduler/governor | Capture emits telemetry (queues, drops, lag, CPU) | missing | autocapture/runtime/governor.py; autocapture/runtime/scheduler.py; autocapture/runtime/budgets.py; plugins/builtin/runtime_governor/plugin.py | Implement per blueprint; enforce in: capture pipeline emits telemetry events and exposes metrics endpoint | Test: telemetry includes queue depths, drops, lag, CPU; Websocket (I83) streams telemetry with stable schema |
| I047 | Phase 5: Scheduler/governor | Governor outputs feed backpressure and job admission | missing | autocapture/runtime/governor.py; autocapture/runtime/scheduler.py; autocapture/runtime/budgets.py; plugins/builtin/runtime_governor/plugin.py | Implement per blueprint; enforce in: governor decisions affect capture rate/quality and enrichment admission | Integration test: governor changes lead to fps/quality changes within bounded time |
| I048 | Phase 5: Scheduler/governor | Immediate ramp down on user input (cancel/deprioritize heavy jobs) | missing | autocapture/runtime/governor.py; autocapture/runtime/scheduler.py; autocapture/runtime/budgets.py; plugins/builtin/runtime_governor/plugin.py | Implement per blueprint; enforce in: scheduler cancels/deprioritizes heavy jobs on new input events | Test: user input interrupts ongoing enrichment within timeout budget |
| I116 | Phase 5: Scheduler/governor | Model execution budgets per idle window | partial | autocapture/runtime/governor.py; autocapture/runtime/scheduler.py; autocapture/runtime/budgets.py; plugins/builtin/runtime_governor/plugin.py | Implement per blueprint; enforce in: scheduler budgets for model execution (CPU/GPU time, tokens, batch sizes) | Test: budgets enforced; jobs stop/continue across idle windows without violating budget |
| I117 | Phase 5: Scheduler/governor | Preemption/chunking for long jobs | missing | autocapture/runtime/governor.py; autocapture/runtime/scheduler.py; autocapture/runtime/budgets.py; plugins/builtin/runtime_governor/plugin.py | Implement per blueprint; enforce in: all long jobs implemented as chunked work units with checkpoints | Test: job can be paused/resumed without redoing completed work |
| I049 | Phase 6: Security + egress hardening | Egress gateway must be subprocess-hosted; kernel network-denied | partial | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: process model: kernel has network denied; egress plugin runs in subprocess; network guard applied at OS/process boundary where possible | Security test: kernel cannot reach network even if code tries; Test: egress plugin can reach allowlisted endpoints only |
| I050 | Phase 6: Security + egress hardening | Minimize inproc_allowlist; prefer subprocess hosting | missing | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: plugin registry: inproc_allowlist minimized; default subprocess | Gate: fail if new inproc plugin added without security justification entry |
| I051 | Phase 6: Security + egress hardening | Capability bridging for subprocess plugins (real capability plumbing) | partial | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: subprocess host runner provides real capability access (not None) | Test: subprocess plugin receives only declared capabilities and can operate |
| I052 | Phase 6: Security + egress hardening | Enforce least privilege per plugin manifest | partial | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: plugin manifest declares required capabilities; loader enforces deny-by-default | Test: plugin without declared capability cannot access it |
| I053 | Phase 6: Security + egress hardening | Enforce filesystem permission policy declared by plugins | missing | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: filesystem sandboxing for subprocess plugins; manifest-declared read/readwrite paths enforced | Test: plugin cannot read outside allowed roots (integration) |
| I054 | Phase 6: Security + egress hardening | Strengthen Windows job object restrictions (limits) | partial | autocapture_nx/windows/win_sandbox.py | Implement per blueprint; enforce in: Windows job object: CPU/memory limits, kill-on-close, child restrictions | Test: runaway plugin is terminated and reported |
| I055 | Phase 6: Security + egress hardening | Sanitize subprocess env; pin caches; disable proxies | missing | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: subprocess environment sanitizer in host | Test: proxy env vars removed; cache dirs pinned |
| I056 | Phase 6: Security + egress hardening | Plugin RPC timeouts and watchdogs | missing | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: plugin RPC layer: timeouts + watchdog to restart hung plugins | Test: hung plugin call times out and system recovers without deadlock |
| I057 | Phase 6: Security + egress hardening | Max message size limits in plugin RPC protocol | missing | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: plugin RPC protocol enforces max message sizes and streaming | Test: oversized message rejected; chunked streaming used for large blobs |
| I058 | Phase 6: Security + egress hardening | Harden hashing against symlinks / filesystem nondeterminism | partial | autocapture_nx/kernel/hashing.py | Implement per blueprint; enforce in: hashing policy: symlink handling defined and enforced | Test: symlinks in plugin root are rejected or hashed deterministically |
| I059 | Phase 6: Security + egress hardening | Secure vault file permissions (Windows ACLs) | partial | autocapture_nx/kernel/crypto.py; autocapture_nx/kernel/keyring.py; autocapture_nx/windows/dpapi.py | Implement per blueprint; enforce in: vault and data dirs created with restrictive ACLs on Windows | Test: created files are not world-readable (platform-dependent assertions) |
| I060 | Phase 6: Security + egress hardening | Separate keys by purpose (metadata/media/tokenization/anchor) | partial | autocapture_nx/kernel/crypto.py; autocapture_nx/kernel/keyring.py; autocapture_nx/windows/dpapi.py | Implement per blueprint; enforce in: key manager defines separate keys per purpose + key ids | Test: rotating one key does not break others; derived artifacts remain readable as policy dictates |
| I061 | Phase 6: Security + egress hardening | Anchor signing (HMAC/signature) with separate key domain | missing | plugins/builtin/anchor_basic/plugin.py; tests/test_anchor.py | Implement per blueprint; enforce in: anchor plugin uses HMAC/signature over ledger head | Test: anchor verify fails if anchor modified or wrong key used |
| I062 | Phase 6: Security + egress hardening | Add verify commands (ledger/anchors/evidence) | partial | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: verify CLI/API: `verify ledger`, `verify anchors`, `verify evidence` | Golden verification suite passes; tamper cases fail |
| I063 | Phase 6: Security + egress hardening | Audit security events in ledger (key rotations, lock updates, config) | partial | plugins/builtin/ledger_basic/plugin.py; plugins/builtin/journal_basic/plugin.py; autocapture/pillars/citable.py; tests/test_ledger_journal.py | Implement per blueprint; enforce in: ledger event types for security-relevant operations | Test: key rotation and lock updates emit ledger entries |
| I064 | Phase 6: Security + egress hardening | Dependency pinning + hash checking (supply chain) | missing | pyproject.toml | Implement per blueprint; enforce in: runtime dependency verification and build-time pinning | CI verifies dependency hashes; runtime doctor reports mismatches |
| I119 | Phase 6: Security + egress hardening | Persist entity-tokenizer key id/version; version tokenization | missing | autocapture_nx/kernel/crypto.py; autocapture_nx/kernel/keyring.py; autocapture_nx/windows/dpapi.py | Implement per blueprint; enforce in: tokenizer plugin stores key id/version used for each tokenization | Test: tokenization output is stable under same key id; rotation yields new version |
| I120 | Phase 6: Security + egress hardening | Ledger sanitized egress packets (hash + schema version) | missing | autocapture_nx/plugin_system/registry.py; autocapture_nx/plugin_system/host.py; autocapture_nx/plugin_system/runtime.py; autocapture/plugins/policy_gate.py | Implement per blueprint; enforce in: egress gateway writes ledger entry for each sanitized outbound packet | Test: egress attempt emits `egress.packet` ledger entry with hash + schema version |
| I078 | Phase 7: FastAPI UX facade + Web Console | FastAPI UX facade as canonical interface | partial | autocapture/web/api.py; autocapture/web/routes; autocapture/ux/facade.py | Implement per blueprint; enforce in: new FastAPI app provides canonical UX facade endpoints; kernel exposes only internal APIs; UI/CLI call facade | API contract tests: endpoints stable and validated against schemas; Security: binds to localhost by default; requires auth token (I82) |
| I079 | Phase 7: FastAPI UX facade + Web Console | CLI parity: CLI calls shared UX facade functions | partial | autocapture/web/api.py; autocapture/web/routes; autocapture/ux/facade.py | Implement per blueprint; enforce in: CLI uses shared UX facade functions (no direct kernel calls) | Test: CLI commands produce identical results as API endpoints |
| I080 | Phase 7: FastAPI UX facade + Web Console | Web Console UI (status/timeline/query/proof/plugins/keys) | partial | autocapture/web/api.py; autocapture/web/routes; autocapture/ux/facade.py | Implement per blueprint; enforce in: Web Console served by FastAPI (or static assets) as sole maintained UI | UI smoke tests: load pages and call API endpoints (headless); API snapshot tests for UI-critical views |
| I081 | Phase 7: FastAPI UX facade + Web Console | Alerts panel driven by journal events | missing | autocapture/web/api.py; autocapture/web/routes; autocapture/ux/facade.py | Implement per blueprint; enforce in: alerts derived from journal/telemetry streams | Test: disk pressure and capture drops appear as alerts |
| I082 | Phase 7: FastAPI UX facade + Web Console | Local-only auth boundary (bind localhost + token) | missing | autocapture/web/api.py; autocapture/web/routes; autocapture/ux/facade.py | Implement per blueprint; enforce in: API auth middleware: token-based auth; localhost binding by default | Security test: state-changing endpoints require auth token |
| I083 | Phase 7: FastAPI UX facade + Web Console | Websocket for live telemetry | missing | autocapture/web/api.py; autocapture/web/routes; autocapture/ux/facade.py | Implement per blueprint; enforce in: websocket endpoint streams telemetry and job status | Test: websocket schema stable and rate-limited |
| I121 | Phase 7: FastAPI UX facade + Web Console | Egress approval workflow in UI | missing | autocapture/web/api.py; autocapture/web/routes; autocapture/ux/facade.py | Implement per blueprint; enforce in: UI + facade implement explicit approval flow for any outbound egress | Test: egress blocked without approval; approved egress logs approval id + packet hash (I120) |
| I114 | Phase 8: Optional expansion plugins | Clipboard capture plugin (local-only, append-only) | missing | plugins/builtin/ | Implement per blueprint; enforce in: new clipboard capture plugin (subprocess-hosted by default) | Test: disabled by default; when enabled, records are append-only and ledgered; Security: redaction policy for sensitive clipboard types (optional) is explicit |
| I115 | Phase 8: Optional expansion plugins | File activity capture plugin (USN journal / watcher) | missing | plugins/builtin/ | Implement per blueprint; enforce in: new file activity plugin (Windows USN journal or watcher) | Test: disabled by default; when enabled, events are time-ordered and searchable |
| I122 | Phase 8: Optional expansion plugins | Plugin hot-reload with hash verification and safe swap | missing | autocapture_nx/plugin_system/registry.py | Implement per blueprint; enforce in: plugin manager supports hot-reload for non-core plugins with hash verification | Test: hot-reload updates plugin only if lockfile updated and verified; Test: in-flight jobs are drained/cancelled safely on reload |
